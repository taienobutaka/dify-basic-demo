<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>商品レビュー判定AI（テスト環境）</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", sans-serif; margin: 24px; }
    textarea { width: 100%; max-width: 720px; }
    button { margin-top: 10px; padding: 8px 14px; }
    pre { background: #111; color: #eee; padding: 12px; border-radius: 8px; max-width: 720px; overflow: auto; }
  </style>
</head>
<body>
  <h2>商品レビュー判定AI（demo環境）</h2>

  <label for="review">レビュー文</label><br />
  <textarea id="review" rows="5" placeholder="例：美味しかった / マズイ / すぐ壊れた など"></textarea><br />

  <button id="btn" onclick="analyze()">判定する</button>

  <h3>結果</h3>
  <pre id="result">{}</pre>

<script>
async function analyze() {
  const btn = document.getElementById("btn");
  const text = document.getElementById("review").value.trim();
  const resultEl = document.getElementById("result");

  if (!text) {
    resultEl.textContent = JSON.stringify({ error: "レビュー文を入力してください" }, null, 2);
    return;
  }

  btn.disabled = true;
  resultEl.textContent = "判定中...";

  try {
    const res = await fetch("/api/analyze", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ query: text })
    });

    // Basic認証エラーなど
    if (!res.ok) {
      const t = await res.text();
      resultEl.textContent = JSON.stringify({ status: res.status, message: t }, null, 2);
      return;
    }

    const data = await res.json();
    // Difyの返却が大きいので、必要なら data.answer のみ表示でもOK
    resultEl.textContent = JSON.stringify(data, null, 2);
  } catch (e) {
    resultEl.textContent = JSON.stringify({ error: String(e) }, null, 2);
  } finally {
    btn.disabled = false;
  }
}
</script>

</body>
</html>